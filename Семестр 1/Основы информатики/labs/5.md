```scheme
(define (get_command_index token program index)
  (if (equal? (vector-ref program index) token)
      index
      (get_command_index token program (+ 1  index))))

(define (interpret program init-stack)
  (let interpreter ((index 0) (stack init-stack) (stack_ret '()) (definitions '()))
    (if (= index (vector-length program))
        stack
        (let ((command (vector-ref program index)))
          (cond
            ((number? command) (interpreter (+ 1  index) (cons command stack) stack_ret definitions))
            ((equal? command '+) (interpreter (+ 1  index) (cons (+ (cadr stack) (car stack)) (cddr stack)) stack_ret definitions))
            ((equal? command '-) (interpreter (+ 1  index) (cons (- (cadr stack) (car stack)) (cddr stack)) stack_ret definitions))
            ((equal? command '*) (interpreter (+ 1  index) (cons (* (cadr stack) (car stack)) (cddr stack)) stack_ret definitions))
            ((equal? command '/) (interpreter (+ 1  index) (cons (quotient (cadr stack) (car stack)) (cddr stack)) stack_ret definitions))
            ((equal? command 'mod) (interpreter (+ 1  index) (cons (remainder (cadr stack) (car stack)) (cddr stack)) stack_ret definitions))
            ((equal? command '=) (interpreter (+ 1  index) (cons (if (= (cadr stack) (car stack)) -1 0) (cddr stack)) stack_ret definitions))
            ((equal? command '>) (interpreter (+ 1  index) (cons (if (> (cadr stack) (car stack)) -1 0) (cddr stack)) stack_ret definitions))
            ((equal? command '<) (interpreter (+ 1  index) (cons (if (< (cadr stack) (car stack)) -1 0) (cddr stack)) stack_ret definitions))                
            ((equal? command 'and) (interpreter (+ 1  index) (cons (if (and (= (car stack) -1) (= (cadr stack) -1)) -1 0) (cddr stack)) stack_ret definitions))
            ((equal? command 'or) (interpreter (+ 1  index) (cons (if (or (= (car stack) -1) (= (cadr stack) -1)) -1 0) (cddr stack)) stack_ret definitions))
            ((equal? command 'neg) (interpreter (+ 1  index) (cons (- (car stack)) (cdr stack)) stack_ret definitions))
            ((equal? command 'not) (interpreter (+ 1  index) (cons (if (= (car stack) 0) -1 0) (cdr stack)) stack_ret definitions))
            ((equal? command 'drop) (interpreter (+ 1  index) (cdr stack) stack_ret definitions))
            ((equal? command 'swap) (interpreter (+ 1  index) (append (list (cadr stack) (car stack)) (cddr stack)) stack_ret definitions))
            ((equal? command 'dup) (interpreter (+ 1  index) (cons (car stack) stack) stack_ret definitions))
            ((equal? command 'over) (interpreter (+ 1  index) (cons (cadr stack) stack) stack_ret definitions))
            ((equal? command 'rot) (interpreter (+ 1  index) (append (list (caddr stack) (cadr stack) (car stack)) (cdddr stack)) stack_ret definitions))
            ((equal? command 'depth) (interpreter (+ 1  index) (cons (length stack) stack) stack_ret definitions))
            ((equal? command 'define) (interpreter (+ 1  (get_command_index 'end program index)) stack stack_ret
                                                (cons (list (vector-ref program (+ 1  index)) (+ index 2)) definitions)))            
            
            ((equal? command 'end) (interpreter (car stack_ret) stack (cdr stack_ret) definitions))
            ((equal? command 'exit) (interpreter (car stack_ret) stack (cdr stack_ret) definitions))
            
            ((equal? command 'if) (interpreter (if (zero? (car stack)) (+ 1  (get_command_index 'endif program index)) (+ 1  index)) (cdr stack) stack_ret definitions))
            ((equal? command 'endif) (interpreter (+ 1  index) stack stack_ret definitions))
            ((equal? command 'while) (if (zero? (car stack))
                                      (interpreter (+ 1  (get_command_index 'endwhile program index)) stack stack_ret definitions)
                                      (interpreter (+ 1  index) stack (cons index stack_ret) definitions)))
            ((equal? command 'endwhile) (interpreter (car stack_ret) stack (cdr stack_ret) definitions))
            ((equal? command 'do) (interpreter (+ 1  index) stack (cons index stack_ret) definitions))
            ((equal? command 'until) (interpreter (if (zero? (car stack)) (+ 1  index) (car stack_ret)) stack (cdr stack_ret) definitions))
            ((equal? command 'for) (if (<= (car stack) (cadr stack))
                                    (interpreter (+ 1  index) stack (cons index stack_ret) definitions)
                                    (interpreter (+ 1  (get_command_index 'endfor program index)) (cddr stack) stack_ret definitions)))
            ((equal? command 'endfor) (interpreter (car stack_ret) (cons (+ 1  (car stack)) (cdr stack)) (cdr stack_ret) definitions))
            (else (interpreter (cadr (assoc command definitions)) stack (cons (+ 1  index) stack_ret) definitions)))))))


(interpret #(define -- 1 - end
                           define =0? dup 0 = end
                           define =1? dup 1 = end
                           define factorial
                           =0? if drop 1 exit endif
                           =1? if drop 1 exit endif
                           dup --
                           factorial
                           *
                           end
                           0 factorial
                           1 factorial
                           2 factorial
                           3 factorial
                           4 factorial)
                         '())



```
